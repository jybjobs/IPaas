<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloud.paas.systemmanager.dao.DictTypeDAO">
  <resultMap id="BaseResultMap" type="com.cloud.paas.systemmanager.model.DictType">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 07 14:49:58 CST 2017.
    -->
    <id column="dict_type_id" jdbcType="INTEGER" property="dictTypeId" />
    <result column="dict_type_name" jdbcType="VARCHAR" property="dictTypeName" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="creator" jdbcType="VARCHAR" property="creator" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="disable_flag" jdbcType="INTEGER" property="disableFlag" />
    <result column="del_flag" jdbcType="INTEGER" property="delFlag" />
    <result column="dict_type_version" jdbcType="VARCHAR" property="dictTypeVersion" />
  </resultMap>

  <!--获取指定类型键值对-->
  <resultMap id="DictTypeItemVO" type="com.cloud.paas.systemmanager.vo.dictory.DictTypeItemVO">
  <result column="dict_type_name" jdbcType="VARCHAR" property="dictTypeName" />
  <result column="title" jdbcType="VARCHAR" property="title" />
  <result column="remark" jdbcType="VARCHAR" property="remark" />
  <collection property="listDictItem" ofType="com.cloud.paas.systemmanager.vo.dictory.DictItemVO">
    <result column="dict_item_name" jdbcType="VARCHAR" property="dictItemName" />
    <result column="dict_item_code" jdbcType="VARCHAR" property="dictItemCode" />
  </collection>
</resultMap>

  <!--获取字典类型及内容-->
  <resultMap id="dict" type="com.cloud.paas.systemmanager.vo.dictory.Dict">
    <id column="dict_type_id" jdbcType="INTEGER" property="dictTypeId" />
    <result column="dict_type_name" jdbcType="VARCHAR" property="dictTypeName" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="creator" jdbcType="VARCHAR" property="creator" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="disable_flag" jdbcType="INTEGER" property="disableFlag" />
    <result column="del_flag" jdbcType="INTEGER" property="delFlag" />
    <result column="dict_type_version" jdbcType="VARCHAR" property="dictTypeVersion" />
    <!--一对多关系-->
    <collection property="dictItems" ofType="com.cloud.paas.systemmanager.model.DictItem">
      <id column="dict_item_id" jdbcType="INTEGER" property="dictItemId"/>
      <result column="item_type_id" jdbcType="INTEGER" property="dictTypeId"/>
      <result column="dict_item_name" jdbcType="VARCHAR" property="dictItemName"/>
      <result column="dict_item_code" jdbcType="VARCHAR" property="dictItemCode"/>
      <result column="sort" jdbcType="INTEGER" property="sort"/>
      <result column="item_creator" jdbcType="VARCHAR" property="creator"/>
      <result column="item_create_time" jdbcType="TIMESTAMP" property="createTime"/>
      <result column="item_update_time" jdbcType="TIMESTAMP" property="updateTime"/>
    </collection>
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 07 14:49:58 CST 2017.
    -->
    dict_type_id, dict_type_name, title, remark, creator, create_time, update_time, disable_flag, 
    del_flag, dict_type_version
  </sql>

  <!--根据id查找-->
  <select id="doFindById" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 07 14:49:58 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from acp_dict_type
    where dict_type_id = #{dictTypeId,jdbcType=INTEGER}
  </select>

  <!--根据name查找-->
  <select id="doFindByName" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 07 14:49:58 CST 2017.
    -->
    select
    <include refid="Base_Column_List" />
    from acp_dict_type
    where dict_type_name = #{dictTypeName,jdbcType=VARCHAR}
  </select>


  <!--根据title查找-->
  <select id="doFindByTitle" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from acp_dict_type
    where title = #{title,jdbcType=VARCHAR}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 07 14:49:58 CST 2017.
    -->
    delete from acp_dict_type
    where dict_type_id = #{dictTypeId,jdbcType=INTEGER}
  </delete>

    <!--创建字典类型-->
  <insert id="doInsertByBean" parameterType="com.cloud.paas.systemmanager.model.DictType">
    <selectKey keyProperty="dictTypeId" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into acp_dict_type
    <trim prefix="(" suffix=")" suffixOverrides=",">
      dict_type_id,
      <if test="dictTypeName != null">
        dict_type_name,
      </if>
      <if test="title != null">
        title,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <if test="createTime != null">
        create_time,
      </if>

      <if test="dictTypeVersion != null">
        dict_type_version,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{dictTypeId,jdbcType=INTEGER},
      <if test="dictTypeName != null">
        #{dictTypeName,jdbcType=VARCHAR},
      </if>
      <if test="title != null">
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>

      <if test="dictTypeVersion != null">
        #{dictTypeVersion,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <!--修改字典类型-->
  <update id="doUpdateByBean" parameterType="com.cloud.paas.systemmanager.model.DictType">
    update acp_dict_type
    <set>
      <if test="title != null">
        title = #{title,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = now(),
      </if>
      <if test="dictTypeVersion != null">
        dict_type_version = #{dictTypeVersion,jdbcType=VARCHAR},
      </if>
    </set>
    where dict_type_id = #{dictTypeId,jdbcType=INTEGER}
  </update>

  <!--设置禁用状态-->
  <update id="doChangeDisable" parameterType="com.cloud.paas.systemmanager.model.DictType">
    update acp_dict_type
    <set>
      disable_flag=#{disableFlag,jdbcType=INTEGER},
      update_time = now(),
    </set>
    where dict_type_id = #{dictTypeId,jdbcType=INTEGER}
  </update>

  <!--设置删除状态-->
  <update id="doChangeDel" parameterType="com.cloud.paas.systemmanager.model.DictType">
    update acp_dict_type
    <set>
      update_time = now(),
      del_flag=#{delFlag,jdbcType=INTEGER},
    </set>
    where dict_type_id = #{dictTypeId,jdbcType=INTEGER}
  </update>

  <!--查询所有字典类型-->
  <select id="doSearchList" resultMap="BaseResultMap">
    select
     <include refid="Base_Column_List" />
    from
      acp_dict_type
  </select>

  <!--根据字典类型名查询所有键值对-->
  <select id="getItemByTypeName" resultMap="DictTypeItemVO" parameterType="java.util.List">
    select
      dict_type.dict_type_name,
      dict_type.title,
      dict_type.remark,
      dict_item.dict_item_name,
      dict_item.dict_item_code
    from
      acp_dict_type dict_type
    left join
      acp_dict_item dict_item
    on dict_type.dict_type_id=dict_item.dict_type_id
    where dict_type.disable_flag=0
      and dict_item.del_flag=0
    having
      dict_type.dict_type_name in
    <foreach collection="list" index="index" item="dictTypeName" open="(" separator="," close=")">
      #{dictTypeName}
    </foreach>
    order BY
      dict_type.dict_type_id ASC,dict_item.sort ASC
  </select>

  <!--分页查找DictIdList-->
  <select id="findDictIdListByCondition" resultMap="BaseResultMap" parameterType="com.cloud.paas.systemmanager.qo.dictionary.DictCondition">
    select
      <include refid="Base_Column_List" />
    from
      acp_dict_type dict_type
    <where>
      del_flag!=1
      <if test="condition!= null and condition !=''" >
        and dict_type.dict_type_name like concat('%',#{condition,jdbcType=VARCHAR}, '%')
        or  dict_type.title like concat('%',#{condition,jdbcType=VARCHAR}, '%')
        or  dict_type.dict_type_id in(
        select
        dict_item.dict_type_id
        from
        acp_dict_item dict_item
        where
        dict_item.dict_item_name like concat('%',#{condition,jdbcType=VARCHAR}, '%')
        )
      </if>
    </where>
    order BY
    dict_type.dict_type_id ASC
  </select>

  <!--分页查询  参数是List<Integer> -->
  <select id="findDictIdListByConditionResult" resultMap="dict" parameterType="java.util.List">
     SELECT
      dict_type.dict_type_id,
      dict_type.dict_type_name,
      dict_type.title,
      dict_type.remark,
      dict_type.creator,
      dict_type.create_time,
      dict_type.update_time,
      dict_type.disable_flag,
      dict_type.del_flag,
      dict_type.dict_type_version,
      dict_item.dict_type_id item_type_id,
      dict_item.dict_item_id,
      dict_item.dict_item_name ,
      dict_item.dict_item_code,
      dict_item.sort,
      dict_item.creator item_creator,
      dict_item.create_time item_create_time,
      dict_item.update_time item_update_time,
      dict_item.del_flag
    FROM
      acp_dict_type dict_type
    left join
    (SELECT  * FROM
      acp_dict_item dict_item
      WHERE dict_item.del_flag=0
    ) as dict_item
    ON dict_type.dict_type_id = dict_item.dict_type_id
    <where>
      <if test="list.size()!=0">
        AND dict_type.disable_flag = 0
        AND dict_type.del_flag = 0
        AND dict_type.dict_type_id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
          #{item}
        </foreach>
      </if>
      <if test="list.size()==0">
        AND dict_type.dict_type_id = ""
      </if>
    </where>
     order BY
    dict_type.dict_type_id ASC,dict_item.sort ASC
  </select>

  <!--根据条件（类型名/类型标题/字典名称）查询字典类型及内容-->
  <select id="searchDict" resultMap="dict" parameterType="com.cloud.paas.systemmanager.qo.dictionary.DictCondition">
    SELECT
      dict_type.dict_type_id,
      dict_type.dict_type_name,
      dict_type.title,
      dict_type.remark,
      dict_type.creator,
      dict_type.create_time,
      dict_type.update_time,
      dict_type.disable_flag,
      dict_type.del_flag,
      dict_type.dict_type_version,

      dict_item.dict_type_id item_type_id,
      dict_item.dict_item_id,
      dict_item.dict_item_name ,
      dict_item.dict_item_code,
      dict_item.sort,
      dict_item.creator item_creator,
      dict_item.create_time item_create_time,
      dict_item.update_time item_update_time,
      dict_item.del_flag
    FROM
      acp_dict_type dict_type
    left join
    (SELECT  * FROM
      acp_dict_item dict_item
      WHERE dict_item.del_flag=0
    ) as dict_item
    on dict_type.dict_type_id=dict_item.dict_type_id
    where dict_type.disable_flag=0
      AND  dict_type.del_flag=0
    <if test="condition!= null and condition !=''" >
      AND dict_type.dict_type_name like concat('%',#{condition,jdbcType=VARCHAR}, '%')
      OR  dict_item.dict_item_name like concat('%',#{condition,jdbcType=VARCHAR}, '%')
      OR  dict_type.title like concat('%',#{condition,jdbcType=VARCHAR}, '%')
    </if>
    order BY
      dict_type.dict_type_id ASC,dict_item.sort ASC
  </select>

  <!--获取所有字典-->
  <select id="getAllDict" resultMap="dict">
    SELECT
    dict_type.dict_type_id,
    dict_type.dict_type_name,
    dict_type.title,
    dict_type.remark,
    dict_type.creator,
    dict_type.create_time,
    dict_type.update_time,
    dict_type.disable_flag,
    dict_type.del_flag,
    dict_type.dict_type_version,

    dict_item.dict_item_id,
    dict_item.dict_item_name,
    dict_item.dict_item_code,
    dict_item.sort,
    dict_item.creator,
    dict_item.create_time,
    dict_item.update_time,
    dict_item.del_flag
    FROM
    acp_dict_type dict_type
    left join
    acp_dict_item dict_item
    on dict_type.dict_type_id=dict_item.dict_type_id
    where dict_type.disable_flag=0
    and dict_item.del_flag=0
    order BY
    dict_type.dict_type_id ASC,dict_item.sort ASC
  </select>

</mapper>